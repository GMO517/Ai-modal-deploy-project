<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>格式化輸入顯示</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link rel="stylesheet" href="./public/css.css">
</head>

<body>

  <input type="file" name="files" id="files" value="" />
  <button type="button" id="btn">修改顏色</button>
  <input type="text" placeholder="起點行數" id="text_num_1">
  <input type="text" placeholder="終點行數" id="text_num_2">
  <input type="color" id="color" value="#f6b73c">
  <button type="button" id="reset">重製顏色</button>(如要選單一行數，兩個行數得一樣)
  



  <div class="chat-messages">資料顯示區塊


  </div>
</body>

<script type="text/javascript">
  let btn = document.getElementById("btn");
  let text_num_1 = document.getElementById("text_num_1");//輸入兩個參數，
  let text_num_2 = document.getElementById("text_num_2"); //用來綁定要選哪些區塊//(同一行的話兩個填一樣參數)
  let color = document.getElementById("color");
  let reset = document.getElementById("reset");//

  btn.onclick = function () {
    alert("請選擇檔案!")
  };
  let files = document.getElementById('files');
  files.onchange = function () {
    let file = files.files[0];
    let reader = new FileReader();
    reader.readAsText(file, 'gb2312');

    reader.onload = function () {
      let originData = reader.result;
      //未處理的資料
      const sectionKeyWord = "*************************************************************************";
      const splitKeyWord = "\n";
      //切割用keyword
      let section = originData.split(sectionKeyWord);

      console.log("sectionKeyWord:" + sectionKeyWord);
      console.log('section:', section);
      // 先切三塊
      let NewData = section.toString().split(splitKeyWord);
      //再切分句 **記得要轉回字串才能處理
      console.log(NewData[0]);
      // 一行一行拆開來列印 TODO
      for (i = 0; i < NewData.length; i++) {
        console.log('NewData' + i + ':', NewData[i]);
        //過濾空句子
        if (NewData[i] != "") {

          createForm(i + '.' + NewData[i]);
        }
      }



      function createForm(x) {

        //創造form區 
        const div = document.createElement('div');
        div.classList.add('message' + i);
        const p = document.createElement('p');
        p.classList.add('meta');
        p.innerText = x;
        div.appendChild(p);
        document.querySelector('.chat-messages').appendChild(div);
        

        btn.onclick = function () {//選擇區塊及改變顏色
          let row_1 = text_num_1.value;
          let row_2 = text_num_2.value;

          if (row_1 <= row_2) {//改變顏色
            for (; row_1 <= row_2; row_1++) {
              let selected_rows = document.querySelector(".message" + row_1)
              selected_rows.style.background = color.value;
            };
          };
            reset.onclick = function () {//重製所有背景顏色
              for(let y=0;y<=i;y++){
              let All_color=document.querySelector(".message" + y);
              All_color.style.background='#FFFFFF';
              };
            };
          
        };





      }
    }
  } 
</script>

</html>